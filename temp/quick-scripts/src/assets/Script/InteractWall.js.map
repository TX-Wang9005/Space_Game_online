{"version":3,"sources":["assets\\Script\\InteractWall.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\ndeclare const firebase: any;\r\n\r\n@ccclass\r\nexport default class InteractWall extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    TopOfIW: cc.Prefab = null;\r\n    @property(cc.AudioClip)\r\n    Ghost: cc.AudioClip = null;    \r\n    @property(cc.AudioClip)\r\n    PlayerOpen: cc.AudioClip = null;\r\n    @property(cc.AudioClip)\r\n    PlayerClose: cc.AudioClip = null;\r\n\r\n    private anim: cc.Animation = null;\r\n    \r\n    private current_user_number: number = 0;\r\n\r\n    private isTouched = false;\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n        this.anim = this.node.getComponent(cc.Animation);\r\n        this.anim.play();\r\n        \r\n        var uid = firebase.auth().currentUser.uid;\r\n        let t = this;\r\n        firebase.database().ref(`user_info/${uid}`).once('value', function (snapshot) {\r\n            if(snapshot.val() != null){\r\n                t.current_user_number = snapshot.val().player_number;\r\n                // console.log(\"IW current_user_number\", t.current_user_number);\r\n            }\r\n        });\r\n        \r\n\r\n        let top = cc.instantiate(this.TopOfIW);\r\n        top.setPosition(this.node.position.x, this.node.position.y+12);\r\n        if(this.node.name == \"IW x1\")\r\n            top.setScale(0.5,1);\r\n        else if(this.node.name == \"IW x2 x2\"){\r\n            top.setScale(2,2);\r\n            top.setPosition(this.node.position.x, this.node.position.y+24);\r\n        }\r\n        cc.find(\"Canvas/PlayerContainer\").addChild(top);\r\n    }\r\n\r\n    update (dt) {\r\n    }\r\n\r\n    onBeginContact(contact, self, other){\r\n        if(this.isTouched) return;\r\n        if(other.node.name == \"player1\" || other.node.name == \"player2\" || other.node.name == \"player3\" || other.node.name == \"player4\" || other.node.name == \"player5\"){\r\n            // console.log(\"IW Begin\");\r\n            if(other.node.group == 'player' || other.node.group == 'Coinplayer'){\r\n                // console.log(\"PB\");\r\n                this.isTouched = true;\r\n                if(!this.anim.getAnimationState('Open').isPlaying) this.anim.play('Open');\r\n                this.scheduleOnce(()=>{\r\n                    let str = \"player\"+this.current_user_number.toString();\r\n                    if(str == other.node.name){\r\n                        if(this.PlayerOpen) cc.audioEngine.playEffect(this.PlayerOpen, false);\r\n                    }\r\n                }, 0.4);\r\n                this.scheduleOnce(()=>{\r\n                    contact.disabled = true;\r\n                }, 0.8);\r\n            }else if(other.node.group == 'ghost'){\r\n                // console.log(\"GB\");\r\n                let action: cc.Action;\r\n                action = cc.fadeTo(0.2, 100);\r\n                other.node.runAction(action);\r\n                this.isTouched = true;\r\n                contact.disabled = true;\r\n                let str = \"player\"+this.current_user_number.toString();\r\n                if(str == other.node.name){\r\n                    if(this.Ghost) cc.audioEngine.playEffect(this.Ghost, false);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    onEndContact(contact, self, other){\r\n        if(other.node.name == \"player1\" || other.node.name == \"player2\" || other.node.name == \"player3\" || other.node.name == \"player4\" || other.node.name == \"player5\"){\r\n            // console.log(\"IW End\");\r\n            if(other.node.group == 'player' || other.node.group == 'Coinplayer'){\r\n                // console.log(\"PE\");\r\n                this.isTouched = false;\r\n                if(!this.anim.getAnimationState('Close').isPlaying) this.anim.play('Close');\r\n                let str = \"player\"+this.current_user_number.toString();\r\n                if(str == other.node.name){\r\n                    if(this.PlayerClose) cc.audioEngine.playEffect(this.PlayerClose, false);\r\n                }\r\n                this.scheduleOnce(()=>{\r\n                    if(!this.anim.getAnimationState('Idle').isPlaying) this.anim.play();\r\n                }, 0.4);\r\n            }else if(other.node.group == 'ghost'){\r\n                // console.log(\"GE\");\r\n                let action: cc.Action;\r\n                action = cc.fadeTo(0.2, 255);\r\n                other.node.runAction(action);\r\n                this.isTouched = false;\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}