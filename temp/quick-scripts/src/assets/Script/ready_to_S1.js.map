{"version":3,"sources":["assets\\Script\\ready_to_S1.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\ndeclare const firebase: any;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n\r\n\r\n    old_time;\r\n    servertime;\r\n    delay;\r\n    condition=false;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n        let ready_press = new cc.Component.EventHandler();\r\n        //console.log(\"1\")\r\n        ready_press.target = this.node;\r\n        ready_press.component = \"ready_to_S1\";\r\n        ready_press.handler = \"ready_player\";\r\n        cc.find(\"Canvas/ready\").getComponent(cc.Button).clickEvents.push(ready_press);\r\n    }\r\n\r\n    ready_player() {\r\n        var user = firebase.auth().currentUser;\r\n        firebase.database().ref(`game${1}/player_ready_number`).once('value', function (snapshot) {\r\n            if (snapshot.val() == null) {\r\n                firebase.database().ref(`game${1}/player_ready_number`).set({ number: 1 });\r\n            }\r\n            else if (snapshot.val().number == '1') {\r\n                firebase.database().ref(`game${1}/player_ready_number`).set({ number: 2 });\r\n\r\n            }\r\n        })\r\n       \r\n\r\n        //get the current time\r\n        var today = new Date();\r\n        var time = today.getTime();\r\n        this.old_time = time;\r\n        console.log(\"old_time: \" + this.old_time);\r\n        //get every player to update the time\r\n        var sessionsRef = firebase.database().ref(\"sessions\");\r\n        sessionsRef.set({\r\n            startedAt: firebase.database.ServerValue.TIMESTAMP\r\n        });\r\n        var handle = this;\r\n        firebase.database().ref(\"sessions\").once('value', function (snapshot) {\r\n            handle.servertime = snapshot.val().startedAt\r\n        })\r\n        console.log(\"delay from p1 to server: \" + (handle.servertime - this.old_time));\r\n        var now = new Date();\r\n        var now_time = now.getTime();\r\n        console.log(now_time - this.old_time);\r\n        this.delay = (now_time - this.old_time) / 1000;\r\n        console.log(\"delay from server to p1: \" + (now_time - handle.servertime));\r\n    }\r\n\r\n    update (dt) {\r\n        var user = firebase.auth().currentUser;\r\n        let handle = this;\r\n        var old = new Date();\r\n                        var time_old = old.getTime();\r\n        if (this.condition == false) {\r\n            //not all the players have been assigned to ready yet\r\n            firebase.database().ref(`game${1}/player_ready_number`).once('value', function (snapshot) {\r\n                if (snapshot.val() != null) {\r\n                    if (snapshot.val().number == '2') {\r\n                        handle.condition = true;\r\n                        //read the data from firebase\r\n                        var current_time = new Date();\r\n                        var time = current_time.getTime();\r\n                        //get teh delay\r\n                        var delay = Math.abs((time - time_old) / 2000);\r\n                        console.log(\"delay time: \" + delay)\r\n                        handle.scheduleOnce(function () {\r\n                            // Here this refers to component\r\n                            cc.director.loadScene(\"GameStage2\");\r\n                        }, 2 - delay);\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\n"]}