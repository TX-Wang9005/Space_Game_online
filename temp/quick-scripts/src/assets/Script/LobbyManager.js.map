{"version":3,"sources":["assets\\Script\\LobbyManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\nimport Player from \"./Player\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\ndeclare const firebase: any;\r\n\r\n@ccclass\r\nexport default class LobbyManager extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    LoadingBG: cc.Node = null;\r\n    @property(cc.Node)\r\n    startingBG: cc.Node = null;\r\n    @property(cc.Node)\r\n    JoinGameText: cc.Node = null;\r\n    @property(cc.Node)\r\n    ReadyLabel: cc.Node = null;\r\n    @property(cc.Node)\r\n    ReadyCountLabel: cc.Node = null;\r\n    @property(cc.Node)\r\n    readyWindow: cc.Node = null;\r\n    @property(cc.AudioClip)\r\n    click: cc.AudioClip = null;\r\n\r\n    private physicManager: cc.PhysicsManager = null;\r\n    initialization = false;\r\n    counting = 0;\r\n\r\n    private current_user_number: number = 0;\r\n    private Max_player_ready_number: number = 5; // 玩家應該要多少人準備才會開始。\r\n\r\n    onLoad() {\r\n        this.physicManager = cc.director.getPhysicsManager();\r\n        this.physicManager.enabled = true;\r\n        this.physicManager.gravity = cc.v2(0, 0);\r\n    }\r\n\r\n    start() {\r\n        this.LoadingBG.active = true;\r\n\r\n        let uid = firebase.auth().currentUser.uid;\r\n        let current_user_number = 0;\r\n        firebase.database().ref(`user_info/${uid}`).once('value', function (snapshot) {\r\n            if (snapshot.val() != null) {\r\n                current_user_number = snapshot.val().player_number;\r\n            }\r\n        })\r\n        this.scheduleOnce(() => {\r\n            // console.log(\"now is:\", current_user_number);\r\n            this.current_user_number = current_user_number;\r\n            if (current_user_number != 0) {\r\n                firebase.database().ref(`player/player${current_user_number}_isReady`).set(false);\r\n                firebase.database().ref(`player/player${current_user_number}_islogin`).set(true);\r\n            }\r\n            switch (current_user_number) {\r\n                case 1:\r\n                    firebase.database().ref('player/player1_islogin').onDisconnect().set(false);\r\n                    break;\r\n                case 2:\r\n                    firebase.database().ref('player/player2_islogin').onDisconnect().set(false);\r\n                    break;\r\n                case 3:\r\n                    firebase.database().ref('player/player3_islogin').onDisconnect().set(false);\r\n                    break;\r\n                case 4:\r\n                    firebase.database().ref('player/player4_islogin').onDisconnect().set(false);\r\n                    break;\r\n                case 5:\r\n                    firebase.database().ref('player/player5_islogin').onDisconnect().set(false);\r\n                    break;\r\n            }\r\n            this.schedule(this.UpdateUser, 1); \r\n            this.schedule(this.UpdateMaxReady, 1);\r\n        }, 1);\r\n\r\n        this.scheduleOnce(() => {\r\n            this.LoadingBG.active = false;\r\n            this.Text1Action();\r\n            this.schedule(this.CheckReadyState, 0.2);\r\n        }, 3);\r\n\r\n        // buttons\r\n        let ready_btn = new cc.Component.EventHandler();\r\n        ready_btn.target = this.node;\r\n        ready_btn.component = \"LobbyManager\";\r\n        ready_btn.handler = \"readyEvent\";\r\n        cc.find(\"Canvas/Main Camera/readyWindow/ready\").getComponent(cc.Button).clickEvents.push(ready_btn);\r\n        let close_btn = new cc.Component.EventHandler();\r\n        close_btn.target = this.node;\r\n        close_btn.component = \"LobbyManager\";\r\n        close_btn.handler = \"closeEvent\";\r\n        cc.find(\"Canvas/Main Camera/readyWindow/close\").getComponent(cc.Button).clickEvents.push(close_btn);\r\n\r\n    }\r\n\r\n    update(dt) {\r\n\r\n    }\r\n    UpdateUser() {\r\n        let handle = this;\r\n        if (this.counting < 5) {\r\n            for (let i = 1; i <= 5; i++) {\r\n                if (cc.find(`Canvas/PlayerContainer/player${i}`).active == true) {\r\n                    continue;\r\n                }\r\n                else {\r\n                    firebase.database().ref(`player/player${i}_islogin`).once('value', function (snapshot) {\r\n                        if (snapshot.val() == true) {\r\n                            console.log(\"Welcome! Player\", i);\r\n                            handle.counting += 1;\r\n                            cc.find(`Canvas/PlayerContainer/player${i}`).active = true;\r\n                            firebase.database().ref(`player_data/player${i}/state_value/moveDirX`).set({ Dir: 0 })\r\n                            firebase.database().ref(`player_data/player${i}/state_value/moveDirY`).set({ Dir: 0 })\r\n                            firebase.database().ref(`player_data/player${i}/state_value/premoveDirX`).set({ Dir: 0 })\r\n                            firebase.database().ref(`player_data/player${i}/state_value/moveable`).set({ moveable: \"true\" })\r\n                            firebase.database().ref(`player_data/player${i}/state_value/X`).set({ x: 16 })\r\n                            firebase.database().ref(`player_data/player${i}/state_value/Y`).set({ y: -48 })\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n    Text1Action() {\r\n        let action: cc.Action;\r\n        let sequence = cc.sequence(cc.scaleTo(0.5, 1.1), cc.scaleTo(0.5, 1));\r\n        action = cc.repeatForever(sequence);\r\n        this.JoinGameText.runAction(action);\r\n    }\r\n    readyEvent() {\r\n        let t = this;\r\n        cc.audioEngine.playEffect(this.click, false);\r\n        // console.log(\"Player\", this.current_user_number, \"is ready\");\r\n        firebase.database().ref(`player/player${t.current_user_number}_isReady`).set(true);\r\n        this.ReadyLabel.runAction(cc.fadeTo(0.1, 255));\r\n    }\r\n    closeEvent() {\r\n        let t = this;\r\n        cc.audioEngine.playEffect(this.click, false);\r\n        // console.log(\"Player\", this.current_user_number, \"is Not ready\");\r\n        firebase.database().ref(`player/player${t.current_user_number}_isReady`).set(false);\r\n        console.log(\"close Computer\");\r\n        this.readyWindow.active = false;\r\n        cc.find(`Canvas/PlayerContainer/player${this.current_user_number}`).getComponent(Player).moveable = true;\r\n        this.ReadyLabel.runAction(cc.fadeTo(0.1, 100));\r\n    }\r\n    CheckReadyState() { // 定期檢查每位玩家是否ready，都準備好就開始。\r\n        let ready_count = 0;\r\n        for (let i = 1; i <= 5; i++) {\r\n            firebase.database().ref(`player/player${i}_isReady`).once('value', function (snapshot) {\r\n                if (snapshot.val() == true) {\r\n                    firebase.database().ref(`player/player${i}_islogin`).once('value', function (snapshot) {\r\n                        if (snapshot.val() == true) {\r\n                            // console.log(\"Check\",i, \"isReady\");\r\n                            ready_count++;\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        this.scheduleOnce(() => {\r\n            let str = \"(\";\r\n            str += ready_count.toString();\r\n            str += \"/\";\r\n            str += this.Max_player_ready_number.toString();\r\n            str += \")\";\r\n            this.ReadyCountLabel.getComponent(cc.Label).string = str;\r\n\r\n            if (ready_count == this.Max_player_ready_number) {\r\n                this.scheduleOnce(() => {\r\n                    if(ready_count != 1)\r\n                        this.startingBG.active = true;\r\n                }, 1);\r\n                this.scheduleOnce(() => {\r\n                    if(ready_count != 1)\r\n                        cc.director.loadScene(\"GameStage1\");\r\n                        // cc.director.loadScene(\"GameEnd\");\r\n                }, 2);\r\n            }\r\n        }, 1);\r\n    }\r\n    UpdateMaxReady(){\r\n        let login_count = 0;\r\n        for(let i=1;i<=5;i++){\r\n            firebase.database().ref(`player/player${i}_islogin`).once('value', function (snapshot) {\r\n                if (snapshot.val() == true) {\r\n                    // console.log(\"Check\",i, \"isReady\");\r\n                    login_count++;\r\n                }\r\n            });\r\n        }\r\n        this.scheduleOnce(()=>{\r\n            if(login_count == 0){\r\n                this.Max_player_ready_number = 5;\r\n            }else{\r\n                this.Max_player_ready_number = login_count;\r\n            }\r\n        },0.5);\r\n    }\r\n}\r\n"]}