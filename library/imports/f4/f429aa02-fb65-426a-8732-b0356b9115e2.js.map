{"version":3,"sources":["assets\\Script\\GameEnd\\GameEndManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\nimport Player from \"../Player\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\ndeclare const firebase: any;\r\n\r\n@ccclass\r\nexport default class GameEndManager extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    loadingBG: cc.Node = null;\r\n\r\n    @property(cc.AudioClip)\r\n    BGM: cc.AudioClip = null;\r\n\r\n    @property(cc.Node)\r\n    Text1: cc.Node = null;\r\n    @property(cc.Node)\r\n    Text2: cc.Node = null;\r\n    @property(cc.Node)\r\n    WinnerLabel: cc.Node = null;\r\n\r\n    private current_user_number: number = 0;\r\n\r\n    private physicManager: cc.PhysicsManager = null;\r\n\r\n    private Round1_winner: number = 0;\r\n    private Round2_winner: number = 0;\r\n    private Round3_winner: number = 0;\r\n    private Round4_winner: number = 0;\r\n    \r\n\r\n    onLoad() {\r\n        this.physicManager = cc.director.getPhysicsManager();\r\n        this.physicManager.enabled = true;\r\n        this.physicManager.gravity = cc.v2(0, 0);\r\n\r\n        var user = firebase.auth().currentUser.uid;\r\n        let player_node_number = 0;\r\n        firebase.database().ref(`user_info/${user}`).once('value', function (snapshot) {\r\n            player_node_number = snapshot.val().player_number;\r\n        }\r\n        );\r\n        this.scheduleOnce(() => {\r\n            this.current_user_number = player_node_number;\r\n        }, 2.5);\r\n\r\n    }\r\n\r\n    start() {\r\n        this.loadingBG.active = true;\r\n        let player1 = cc.find(\"Canvas/PlayerContainer/player1\");\r\n        let player2 = cc.find(\"Canvas/PlayerContainer/player2\");\r\n        let player3 = cc.find(\"Canvas/PlayerContainer/player3\");\r\n        let player4 = cc.find(\"Canvas/PlayerContainer/player4\");\r\n        let player5 = cc.find(\"Canvas/PlayerContainer/player5\");\r\n        if (player1) player1.getComponent(Player).moveable = false;\r\n        if (player2) player5.getComponent(Player).moveable = false;\r\n        if (player3) player5.getComponent(Player).moveable = false;\r\n        if (player4) player5.getComponent(Player).moveable = false;\r\n        if (player5) player5.getComponent(Player).moveable = false;\r\n\r\n        this.Init_player();\r\n        this.FindRoundWinner();\r\n        this.scheduleOnce(() => {\r\n            this.loadingBG.active = false;\r\n            if (player1) player1.getComponent(Player).moveable = true;\r\n            if (player2) player5.getComponent(Player).moveable = true;\r\n            if (player3) player5.getComponent(Player).moveable = true;\r\n            if (player4) player5.getComponent(Player).moveable = true;\r\n            if (player5) player5.getComponent(Player).moveable = true;\r\n            // 開始計時\r\n            cc.audioEngine.playMusic(this.BGM, true);\r\n            cc.audioEngine.setMusicVolume(0.2);\r\n            this.Text1Action();\r\n            this.Text2Action();\r\n        }, 2.5);\r\n\r\n\r\n    }\r\n\r\n    update(dt) {\r\n\r\n    }\r\n    Text1Action() {\r\n        let action: cc.Action;\r\n        let sequence = cc.sequence(cc.scaleTo(0.5, 1.1), cc.scaleTo(0.5, 1));\r\n        action = cc.repeatForever(sequence);\r\n        this.Text1.runAction(action);\r\n    }\r\n    Text2Action() {\r\n        let action: cc.Action;\r\n        let sequence = cc.sequence(cc.scaleTo(0.5, 1.1), cc.scaleTo(0.5, 1));\r\n        action = cc.repeatForever(sequence);\r\n        this.Text2.runAction(action);\r\n    }\r\n    Init_player() {\r\n        let handle = this;\r\n        // initialize players\r\n        for (let i = 1; i <= 5; i++) {\r\n            firebase.database().ref(`player/player${i}_islogin`).once('value', function (snapshot) { // 如果玩家登入\r\n                if (snapshot.val() == true) {\r\n                    cc.find(`Canvas/PlayerContainer/player${i}`).active = true;\r\n                    firebase.database().ref(`player_data/player${i}/state_value/moveDirX`).set({ Dir: 0 })\r\n                    firebase.database().ref(`player_data/player${i}/state_value/moveDirY`).set({ Dir: 0 })\r\n                    firebase.database().ref(`player_data/player${i}/state_value/premoveDirX`).set({ Dir: 0 })\r\n                    firebase.database().ref(`player_data/player${i}/state_value/moveable`).set({ moveable: \"true\" })\r\n                    firebase.database().ref(`player_data/player${i}/state_value/X`).set({ x: -736 })\r\n                    firebase.database().ref(`player_data/player${i}/state_value/Y`).set({ y: -176 })\r\n                }\r\n            })\r\n        }\r\n        // initial End\r\n    }\r\n    FindRoundWinner(){\r\n        let t = this;\r\n        for (let i = 1; i <= 5; i++) {\r\n            firebase.database().ref(`GameResult/Round1/player${i}`).once('value', function (snapshot) {\r\n                if (snapshot.val() != null) {\r\n                    if(snapshot.val() == 80){\r\n                        t.Round1_winner = i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        for (let i = 1; i <= 5; i++) {\r\n            firebase.database().ref(`GameResult/Round2/player${i}`).once('value', function (snapshot) {\r\n                if (snapshot.val() != null) {\r\n                    if(snapshot.val() == 0){\r\n                        t.Round2_winner = i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        for (let i = 1; i <= 5; i++) {\r\n            firebase.database().ref(`GameResult/Round3/player${i}`).once('value', function (snapshot) {\r\n                if (snapshot.val() != null) {\r\n                    if(snapshot.val() == 80){\r\n                        t.Round3_winner = i;\r\n                    }\r\n                }\r\n            })\r\n        }\r\n        // GameStage4\r\n        let coin = [0,0,0,0,0]\r\n        for(let i=1;i<=5;i++){            \r\n            firebase.database().ref(`player_data/player${i}/game2_state/money`).once('value', function (snapshot){\r\n                if(snapshot.val()!=null){\r\n                    coin[i-1] = snapshot.val();\r\n                }\r\n            });\r\n        }\r\n        this.scheduleOnce(()=>{\r\n            let cnt = 0;\r\n            for(let i=0;i<=4;i++){\r\n                cnt = 0;\r\n                for(let j=0;j<=4;j++){\r\n                    if(coin[i]>=coin[j]) cnt++;\r\n                }\r\n                if(cnt == 5){\r\n                    t.Round4_winner = i+1;\r\n                }\r\n            }\r\n            // print winner.\r\n            console.log(\"Winner\", t.Round1_winner, t.Round2_winner, t.Round3_winner, t.Round4_winner)\r\n            let p;\r\n            p = cc.find(`Canvas/ObjContainer/Round1/Champ/P${t.Round1_winner}`)\r\n            if(p) p.active = true;\r\n            p = cc.find(`Canvas/ObjContainer/Round2/Champ/P${t.Round2_winner}`)\r\n            if(p) p.active = true;\r\n            p = cc.find(`Canvas/ObjContainer/Round3/Champ/P${t.Round3_winner}`)\r\n            if(p) p.active = true;\r\n            p = cc.find(`Canvas/ObjContainer/Round4/Champ/P${t.Round4_winner}`)\r\n            if(p) p.active = true;\r\n            firebase.database().ref(`user_list`).once('value', function (snapshot){\r\n                snapshot.forEach(function (s){\r\n                    if(s.val().player_number == t.Round4_winner){\r\n                        t.WinnerLabel.getComponent(cc.Label).string = s.val().email;\r\n                    }\r\n                });\r\n            });\r\n        }, 1.5);\r\n    }\r\n}\r\n"]}